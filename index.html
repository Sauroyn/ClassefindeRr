<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lycée Louis Lachenal</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map { height: 100vh; width: 100%; }
    </style>
</head>
<body>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        // Initialiser la carte
        var map = L.map('map').setView([45.9368, 6.1322], 18);

        // Ajouter le calque de base OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 25,
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        // Définir les données GeoJSON pour chaque étage
        var geojsonDataEtage1 = {
            "type": "FeatureCollection",
            "features": [
                { "type": "Feature", "properties": { "salle": "14" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 6.132163752269974, 45.936876281130914 ], [ 6.13233501289262, 45.936869676118668 ], [ 6.132327047282264, 45.936800216909923 ], [ 6.13215517392036, 45.936807887256258 ], [ 6.132163752269974, 45.936876281130914 ] ] ] } },
                { "type": "Feature", "properties": { "salle": "13" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 6.132334706522989, 45.936869249988817 ], [ 6.132459398962017, 45.936864775625189 ], [ 6.132452046090921, 45.936795103345098 ], [ 6.132327047282264, 45.93680021690993 ], [ 6.132334706522989, 45.936869249988817 ] ] ] } },
                { "type": "Feature", "properties": { "salle": "12" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 6.132218930666844, 45.936722545750392 ], [ 6.132342978502976, 45.936718186750738 ], [ 6.132350944113331, 45.936783171692035 ], [ 6.132225945304675, 45.936788498323175 ], [ 6.132218930666844, 45.936722545750392 ] ] ] } },
                { "type": "Feature", "properties": { "salle": "11" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 6.132094512733808, 45.936727987763149 ], [ 6.132218909125229, 45.936722545750392 ], [ 6.132225974774833, 45.93678850779078 ], [ 6.132100946496017, 45.936793611888618 ], [ 6.132094512733808, 45.936727987763149 ] ] ] } },
                { "type": "Feature", "properties": { "salle": "10 (dessin)" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 6.132094894049651, 45.936728433348819 ], [ 6.132108680683029, 45.936863383525299 ], [ 6.132009761588534, 45.93686721869426 ], [ 6.131993217628478, 45.936732028828473 ], [ 6.132094894049651, 45.936728433348819 ] ] ] } },
                { "type": "Feature", "properties": { "salle": "9" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 6.132107991351361, 45.936863383525299 ], [ 6.132116263331387, 45.936929300454821 ], [ 6.132017688902726, 45.936933854712514 ], [ 6.13202113556107, 45.936967172691617 ], [ 6.131970469683403, 45.936970288760577 ], [ 6.131959440376697, 45.936869855372748 ], [ 6.132107991351361, 45.936863383525299 ] ] ] } },
                { "type": "Feature", "properties": { "salle": "8" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 6.132122122650576, 45.936963337529555 ], [ 6.132021135561073, 45.936966932993982 ], [ 6.132036300857791, 45.937100564256326 ], [ 6.132136770948542, 45.937096609254979 ], [ 6.132122122650576, 45.936963337529555 ] ] ] } },
                { "type": "Feature", "properties": { "salle": "7" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 6.13214504292857, 45.937162166362093 ], [ 6.132160897556957, 45.93730023153347 ], [ 6.132112989005964, 45.937334747772603 ], [ 6.132059221135783, 45.937306463633796 ], [ 6.132043711173229, 45.937166241207152 ], [ 6.13214504292857, 45.937162166362093 ] ] ] } },
                { "type": "Feature", "properties": { "salle": "7B" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 6.132036559357164, 45.937100444407797 ], [ 6.132043969672606, 45.937166121358757 ], [ 6.132145129095028, 45.937162286210487 ], [ 6.132136684782082, 45.937096489406443 ], [ 6.132036559357164, 45.937100444407797 ] ] ] } },
                { "type": "Feature", "properties": { "salle": "15" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 6.132182008339317, 45.93706101423016 ], [ 6.132285408089663, 45.937056939377371 ], [ 6.132301607383884, 45.937193087237624 ], [ 6.132255422162063, 45.937224247792436 ], [ 6.132196139638531, 45.937190690271144 ], [ 6.132182008339317, 45.93706101423016 ] ] ] } },
                { "type": "Feature", "properties": { "salle": "Vie scolaire" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 6.132398803149205, 45.937217056896699 ], [ 6.132407075129231, 45.937282014620784 ], [ 6.132262660144584, 45.937290164292961 ], [ 6.132356753917398, 45.93721897446899 ], [ 6.132398803149205, 45.937217056896699 ] ] ] } },
                { "type": "Feature", "properties": { "salle": "6" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 6.132337452630665, 45.937319047680319 ], [ 6.132344345947356, 45.93738544345981 ], [ 6.13222474690279, 45.937391915246337 ], [ 6.132195450306858, 45.937376574714087 ], [ 6.132219921581108, 45.937360035697978 ], [ 6.132192348314349, 45.937342537892988 ], [ 6.132214751593589, 45.937325519474591 ], [ 6.132337452630665, 45.937319047680319 ] ] ] } },
                { "type": "Feature", "properties": { "salle": "Proviseur adjoint" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 6.132524606178793, 45.937467179671209 ], [ 6.132583888702325, 45.937464063630181 ], [ 6.132581820707317, 45.937438176513218 ], [ 6.132619733949111, 45.937436019252914 ], [ 6.132618355285772, 45.937415645123799 ], [ 6.132520125522944, 45.937421397819847 ], [ 6.132524606178793, 45.937467179671209 ] ] ] } },
                { "type": "Feature", "properties": { "salle": "Secrétaire proviseur adjoint" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 6.132525123177543, 45.937467299518929 ], [ 6.132528914501724, 45.937503253825909 ], [ 6.132626110267048, 45.93749798052901 ], [ 6.132619647782653, 45.937435959329022 ], [ 6.132581820707317, 45.937438176513197 ], [ 6.132583845619094, 45.937464003706296 ], [ 6.132525123177543, 45.937467299518929 ] ] ] } },
                { "type": "Feature", "properties": { "salle": "CDI" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 6.132509570131759, 45.93776937489644 ], [ 6.132555583020663, 45.937766378719459 ], [ 6.132552136362318, 45.937733300914864 ], [ 6.132648642795972, 45.937728027639849 ], [ 6.132625981017355, 45.937497980529024 ], [ 6.132529043751407, 45.937503373673557 ], [ 6.132547698789698, 45.937704687399503 ], [ 6.132506511222474, 45.937736027437552 ], [ 6.132509570131759, 45.93776937489644 ] ] ] } },
                { "type": "Feature", "properties": { "salle": "2" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 6.132740194658255, 45.937589753800559 ], [ 6.132789481872585, 45.937617079015645 ], [ 6.132795341191771, 45.937687069855997 ], [ 6.132846351735274, 45.937714155328727 ], [ 6.132848419730283, 45.937745075896473 ], [ 6.132798787850117, 45.937747952227483 ], [ 6.13270986406482, 45.937695938552061 ], [ 6.132702281416462, 45.937618277489676 ], [ 6.132740194658255, 45.937589753800559 ] ] ] } },
                { "type": "Feature", "properties": { "salle": "1" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 6.132740194658256, 45.937589813724294 ], [ 6.132830927939183, 45.93758472020685 ], [ 6.132834116098152, 45.937613903059308 ], [ 6.132789476487185, 45.937617071525175 ], [ 6.132740194658256, 45.937589813724294 ] ] ] } },
                { "type": "Feature", "properties": { "salle": "Acceuil" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 6.132879843560663, 45.937546320313544 ], [ 6.132928958442077, 45.937574604329996 ], [ 6.132932405100421, 45.9376088807035 ], [ 6.13288001589358, 45.937611637194145 ], [ 6.132877258566904, 45.937579158534689 ], [ 6.132853304291408, 45.937565615767014 ], [ 6.132879843560663, 45.937546320313544 ] ] ] } },
                { "type": "Feature", "properties": { "salle": "Proviseur" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 6.132841413320118, 45.937449004011071 ], [ 6.132912414482022, 45.937445168882363 ], [ 6.132918618467041, 45.937495025534993 ], [ 6.132844859978463, 45.937499100355588 ], [ 6.132841413320118, 45.937449004011071 ] ] ] } },
                { "type": "Feature", "properties": { "salle": "Secrétaire proviseur" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 6.132841413320117, 45.937449004011071 ], [ 6.132845032311377, 45.937498980507932 ], [ 6.132777822473654, 45.937502456089966 ], [ 6.132737668903936, 45.937479685031278 ], [ 6.13277368648364, 45.937451760509674 ], [ 6.132841413320117, 45.937449004011071 ] ] ] } },
                { "type": "Feature", "properties": { "salle": "Intendant" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 6.132767827164454, 45.93740645803701 ], [ 6.132771273822799, 45.937438936797633 ], [ 6.132705097982576, 45.937442292535657 ], [ 6.132701995990066, 45.937410413016266 ], [ 6.132767827164454, 45.93740645803701 ] ] ] } },
                { "type": "Feature", "properties": { "salle": "Secrétaire intendance" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 6.132762829509854, 45.937358518872202 ], [ 6.132767654831537, 45.93740645803701 ], [ 6.132702168322985, 45.937410293168405 ], [ 6.132703719319241, 45.937427671104224 ], [ 6.132678903379158, 45.937429468821406 ], [ 6.132672699394137, 45.937362953246677 ], [ 6.132762829509854, 45.937358518872202 ] ] ] } },
                { "type": "Feature", "properties": { "salle": "Salle des professeurs" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 6.133048729819557, 45.937503354947353 ], [ 6.133187630150852, 45.937495445001844 ], [ 6.133225888058482, 45.937459730385299 ], [ 6.133216237415115, 45.937350908525964 ], [ 6.133023224547805, 45.93736049636356 ], [ 6.133028049869488, 45.937439116569315 ], [ 6.133043042833288, 45.937438577254248 ], [ 6.133048729819557, 45.937503354947353 ] ] ] } }
            ]
        }
;

        var geojsonDataEtage2 = {
            "type": "FeatureCollection",
            "features": [
                { "type": "Feature", "properties": { "salle": "24" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 6.132218592433576, 45.936723513388131 ], [ 6.132342978502976, 45.936718186750738 ], [ 6.132350944113331, 45.936783171692035 ], [ 6.132225945304675, 45.936788498323175 ], [ 6.132218592433576, 45.936723513388131 ] ] ] } },
                { "type": "Feature", "properties": { "salle": "23" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 6.132094512733808, 45.936727987763149 ], [ 6.132218592433576, 45.936723939519112 ], [ 6.132224719826159, 45.936788285257947 ], [ 6.132100946496017, 45.936793611888618 ], [ 6.132094512733808, 45.936727987763149 ] ] ] }
            }]
        };

        // Fonction de style par défaut
        function getDefaultStyle() {
            return {
                color: "#3388ff",
                weight: 2,
                opacity: 1,
                fillColor: "#3388ff",
                fillOpacity: 0.4
            };
        }

        // Fonction d'interaction (survol et clic)
        function onEachFeature(feature, layer) {
            layer.bindTooltip("Salle : " + feature.properties.salle, {
                permanent: true,
                direction: "center",
                className: "leaflet-tooltip-custom"
            });

            layer.on({
                mouseover: function(e) {
                    e.target.setStyle({ fillColor: "#ff7800", color: "#ff7800", fillOpacity: 0.7 });
                },
                mouseout: function(e) {
                    e.target.setStyle(getDefaultStyle());
                },
                click: function(e) {
                    map.fitBounds(e.target.getBounds());
                }
            });
        }

        // Créer les calques GeoJSON pour chaque étage
        var layerEtage1 = L.geoJSON(geojsonDataEtage1, {
            style: getDefaultStyle,
            onEachFeature: onEachFeature
        });

        var layerEtage2 = L.geoJSON(geojsonDataEtage2, {
            style: getDefaultStyle,
            onEachFeature: onEachFeature
        });

        // Ajouter les calques à la carte et définir le contrôle des calques
        var baseMaps = {
            "Étage 1": layerEtage1,
            "Étage 2": layerEtage2
        };

        L.control.layers(baseMaps).addTo(map);

        // Activer un étage par défaut
        layerEtage1.addTo(map);

        // Fonction pour gérer l'affichage des tooltips selon le niveau de zoom
        function updateTooltips() {
            var currentZoom = map.getZoom();
            var minZoomForLabels = 20; // Définir le niveau de zoom à partir duquel les labels s'affichent

            [layerEtage1, layerEtage2].forEach(function(layer) {
                layer.eachLayer(function(featureLayer) {
                    if (currentZoom < minZoomForLabels) {
                        featureLayer.unbindTooltip();
                    } else {
                        featureLayer.bindTooltip("Salle : " + featureLayer.feature.properties.salle, {
                            permanent: true,
                            direction: "center",
                            className: "leaflet-tooltip-custom"
                        });
                    }
                });
            });
        }

        // Ajouter un écouteur pour détecter les changements de niveau de zoom
        map.on('zoomend', updateTooltips);

        // Optionnel : Géolocalisation de l'utilisateur
        navigator.geolocation.watchPosition(function(position) {
            var userLat = position.coords.latitude;
            var userLng = position.coords.longitude;

            L.marker([userLat, userLng]).addTo(map)
                .bindPopup("Votre position réelle")
                .openPopup();

            map.setView([userLat, userLng], map.getZoom());

        }, function(error) {
            console.error("Erreur de géolocalisation : ", error);
        });
    </script>
</body>
</html>
